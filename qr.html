<script>
  const params = new URLSearchParams(window.location.search);
  const cedula = params.get("cedula").toString().trim();

  const qr = new QRious({
    element: document.getElementById('qr'),
    value: cedula,
    size: 200
  });

  const SHEET_ID = '1Apfz0KugvEMqks7jVsby1VCOUC-MW8k_d2YxlpRbRkc';
  const SHEET_NAME = 'Entrada';
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

  fetch(url)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      // Leer cada fila y convertir valores a texto
      const datos = rows
        .map(row => row.c.map(c => c ? c.v.toString().trim() : ""))
        .filter(r => r[5] === cedula)  // Buscar por la columna F (QR)
        .pop(); // Tomar el último registro

      if (datos) {
        const [timestamp, nombre, cedulaReal, tipoProducto, precio, , entregado] = datos;
        document.getElementById("info").innerHTML = `
          <strong>Nombre:</strong> ${nombre}<br>
          <strong>Cédula:</strong> ${cedulaReal}<br>
          <strong>Producto:</strong> ${tipoProducto}<br>
          <strong>Precio:</strong> $${precio}<br>
          <strong>Entregado:</strong> ${entregado || 'No'}
        `;
      } else {
        document.getElementById("info").innerText = "No se encontró información para esta cédula.";
      }
    })
    .catch(err => {
      console.error(err);
      document.getElementById("info").innerText = "Error al cargar los datos.";
    });
</script>
